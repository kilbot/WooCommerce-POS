var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almondLib",function(){}),function(){function e(e,t,n){n=(n||0)-1;for(var r=e?e.length:0;++n<r;)if(e[n]===t)return n;return-1}function t(t,n){var r=typeof n;if(t=t.l,"boolean"==r||null==n)return t[n]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:g+n;return t=(t=t[r])&&t[i],"object"==r?t&&-1<e(t,n)?0:-1:t?0:-1}function n(e){var t=this.l,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?e:g+e,t=t[n]||(t[n]={});"object"==n?(t[r]||(t[r]=[])).push(e):t[r]=!0}}function r(e){return e.charCodeAt(0)}function i(e,t){for(var n=e.m,r=t.m,i=-1,s=n.length;++i<s;){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined")return 1;if(o<u||typeof u=="undefined")return-1}}return e.n-t.n}function s(e){var t=-1,r=e.length,i=e[0],s=e[r/2|0],o=e[r-1];if(i&&typeof i=="object"&&s&&typeof s=="object"&&o&&typeof o=="object")return!1;for(i=a(),i["false"]=i["null"]=i["true"]=i.undefined=!1,s=a(),s.k=e,s.l=i,s.push=n;++t<r;)s.push(e[t]);return s}function o(e){return"\\"+V[e]}function u(){return d.pop()||[]}function a(){return v.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,"undefined":!1,o:null}}function f(e){e.length=0,d.length<b&&d.push(e)}function l(e){var t=e.l;t&&l(t),e.k=e.l=e.m=e.object=e.number=e.string=e.o=null,v.length<b&&v.push(e)}function c(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1;n=n-t||0;for(var i=Array(0>n?0:n);++r<n;)i[r]=e[t+r];return i}function h(n){function d(e,t,n){if(!e||!X[typeof e])return e;t=t&&typeof n=="undefined"?t:tt(t,n,3);for(var r=-1,i=X[typeof e]&&jn(e),s=i?i.length:0;++r<s&&(n=i[r],!1!==t(e[n],n,e)););return e}function v(e,t,n){var r;if(!e||!X[typeof e])return e;t=t&&typeof n=="undefined"?t:tt(t,n,3);for(r in e)if(!1===t(e[r],r,e))break;return e}function b(e,t,n){var r,i=e,s=i;if(!i)return s;for(var o=arguments,u=0,a=typeof n=="number"?2:o.length;++u<a;)if((i=o[u])&&X[typeof i])for(var f=-1,l=X[typeof i]&&jn(i),c=l?l.length:0;++f<c;)r=l[f],"undefined"==typeof s[r]&&(s[r]=i[r]);return s}function V(e,t,n){var r,i=e,s=i;if(!i)return s;var o=arguments,u=0,a=typeof n=="number"?2:o.length;if(3<a&&"function"==typeof o[a-2])var f=tt(o[--a-1],o[a--],2);else 2<a&&"function"==typeof o[a-1]&&(f=o[--a]);for(;++u<a;)if((i=o[u])&&X[typeof i])for(var l=-1,c=X[typeof i]&&jn(i),h=c?c.length:0;++l<h;)r=c[l],s[r]=f?f(s[r],i[r]):i[r];return s}function J(e){var t,n=[];if(!e||!X[typeof e])return n;for(t in e)yn.call(e,t)&&n.push(t);return n}function K(e){return e&&typeof e=="object"&&!Bn(e)&&yn.call(e,"__wrapped__")?e:new Q(e)}function Q(e,t){this.__chain__=!!t,this.__wrapped__=e}function G(e){function t(){if(r){var e=c(r);bn.apply(e,arguments)}if(this instanceof t){var s=et(n.prototype),e=n.apply(s,e||arguments);return Et(e)?e:s}return n.apply(i,e||arguments)}var n=e[0],r=e[2],i=e[4];return Hn(t,e),t}function Z(e,t,n,r,i){if(n){var s=n(e);if(typeof s!="undefined")return s}if(!Et(e))return e;var o=cn.call(e);if(!U[o])return e;var a=Dn[o];switch(o){case H:case B:return new a(+e);case F:case R:return new a(e);case q:return s=a(e.source,N.exec(e)),s.lastIndex=e.lastIndex,s}if(o=Bn(e),t){var l=!r;r||(r=u()),i||(i=u());for(var h=r.length;h--;)if(r[h]==e)return i[h];s=o?a(e.length):{}}else s=o?c(e):V({},e);return o&&(yn.call(e,"index")&&(s.index=e.index),yn.call(e,"input")&&(s.input=e.input)),t?(r.push(e),i.push(s),(o?At:d)(e,function(e,o){s[o]=Z(e,t,n,r,i)}),l&&(f(r),f(i)),s):s}function et(e){return Et(e)?Tn(e):{}}function tt(e,t,n){if(typeof e!="function")return Vt;if(typeof t!="undefined"&&"prototype"in e){var r=e.__bindData__;if(typeof r=="undefined"&&(Pn.funcNames&&(r=!e.name),r=r||!Pn.funcDecomp,!r)){var i=mn.call(e);Pn.funcNames||(r=!C.test(i)),r||(r=O.test(i),Hn(e,r))}if(!1===r||!0!==r&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Wt(e,t)}return e}function nt(e){function t(){var e=a?o:this;if(i){var d=c(i);bn.apply(d,arguments)}return(s||l)&&(d||(d=c(arguments)),s&&bn.apply(d,s),l&&d.length<u)?(r|=16,nt([n,h?r:-4&r,d,null,o,u])):(d||(d=arguments),f&&(n=e[p]),this instanceof t?(e=et(n.prototype),d=n.apply(e,d),Et(d)?d:e):n.apply(e,d))}var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=1&r,f=2&r,l=4&r,h=8&r,p=n;return Hn(t,e),t}function rt(n,r){var i=-1,o=ht(),u=n?n.length:0,a=u>=y&&o===e,f=[];if(a){var c=s(r);c?(o=t,r=c):a=!1}for(;++i<u;)c=n[i],0>o(r,c)&&f.push(c);return a&&l(r),f}function it(e,t,n,r){r=(r||0)-1;for(var i=e?e.length:0,s=[];++r<i;){var o=e[r];if(o&&typeof o=="object"&&typeof o.length=="number"&&(Bn(o)||mt(o))){t||(o=it(o,t,n));var u=-1,a=o.length,f=s.length;for(s.length+=a;++u<a;)s[f++]=o[u]}else n||s.push(o)}return s}function st(e,t,n,r,i,s){if(n){var o=n(e,t);if(typeof o!="undefined")return!!o}if(e===t)return 0!==e||1/e==1/t;if(e===e&&!(e&&X[typeof e]||t&&X[typeof t]))return!1;if(null==e||null==t)return e===t;var a=cn.call(e),l=cn.call(t);if(a==D&&(a=I),l==D&&(l=I),a!=l)return!1;switch(a){case H:case B:return+e==+t;case F:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case q:case R:return e==on(t)}if(l=a==P,!l){var c=yn.call(e,"__wrapped__"),h=yn.call(t,"__wrapped__");if(c||h)return st(c?e.__wrapped__:e,h?t.__wrapped__:t,n,r,i,s);if(a!=I)return!1;if(a=e.constructor,c=t.constructor,a!=c&&!(wt(a)&&a instanceof a&&wt(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}for(a=!i,i||(i=u()),s||(s=u()),c=i.length;c--;)if(i[c]==e)return s[c]==t;var p=0,o=!0;if(i.push(e),s.push(t),l){if(c=e.length,p=t.length,(o=p==c)||r)for(;p--;)if(l=c,h=t[p],r)for(;l--&&!(o=st(e[l],h,n,r,i,s)););else if(!(o=st(e[p],h,n,r,i,s)))break}else v(t,function(t,u,a){return yn.call(a,u)?(p++,o=yn.call(e,u)&&st(e[u],t,n,r,i,s)):void 0}),o&&!r&&v(e,function(e,t,n){return yn.call(n,t)?o=-1<--p:void 0});return i.pop(),s.pop(),a&&(f(i),f(s)),o}function ot(e,t,n,r,i){(Bn(t)?At:d)(t,function(t,s){var o,u,a=t,f=e[s];if(t&&((u=Bn(t))||Un(t))){for(a=r.length;a--;)if(o=r[a]==t){f=i[a];break}if(!o){var l;n&&(a=n(f,t),l=typeof a!="undefined")&&(f=a),l||(f=u?Bn(f)?f:[]:Un(f)?f:{}),r.push(t),i.push(f),l||ot(f,t,n,r,i)}}else n&&(a=n(f,t),typeof a=="undefined"&&(a=t)),typeof a!="undefined"&&(f=a);e[s]=f})}function ut(e,t){return e+vn(_n()*(t-e+1))}function at(n,r,i){var o=-1,a=ht(),c=n?n.length:0,h=[],p=!r&&c>=y&&a===e,d=i||p?u():h;for(p&&(d=s(d),a=t);++o<c;){var v=n[o],m=i?i(v,o,n):v;(r?!o||d[d.length-1]!==m:0>a(d,m))&&((i||p)&&d.push(m),h.push(v))}return p?(f(d.k),l(d)):i&&f(d),h}function ft(e){return function(t,n,r){var i={};n=K.createCallback(n,r,3),r=-1;var s=t?t.length:0;if(typeof s=="number")for(;++r<s;){var o=t[r];e(i,o,n(o,r,t),t)}else d(t,function(t,r,s){e(i,t,n(t,r,s),s)});return i}}function lt(e,t,n,r,i,s){var o=1&t,u=4&t,a=16&t,f=32&t;if(!(2&t||wt(e)))throw new un;a&&!n.length&&(t&=-17,a=n=!1),f&&!r.length&&(t&=-33,f=r=!1);var l=e&&e.__bindData__;return l&&!0!==l?(l=c(l),l[2]&&(l[2]=c(l[2])),l[3]&&(l[3]=c(l[3])),!o||1&l[1]||(l[4]=i),!o&&1&l[1]&&(t|=8),!u||4&l[1]||(l[5]=s),a&&bn.apply(l[2]||(l[2]=[]),n),f&&Sn.apply(l[3]||(l[3]=[]),r),l[1]|=t,lt.apply(null,l)):(1==t||17===t?G:nt)([e,t,n,r,i,s])}function ct(e){return Fn[e]}function ht(){var t=(t=K.indexOf)===Ft?e:t;return t}function pt(e){return typeof e=="function"&&hn.test(e)}function dt(e){var t,n;return e&&cn.call(e)==I&&(t=e.constructor,!wt(t)||t instanceof t)?(v(e,function(e,t){n=t}),typeof n=="undefined"||yn.call(e,n)):!1}function vt(e){return In[e]}function mt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&cn.call(e)==D||!1}function gt(e,t,n){var r=jn(e),i=r.length;for(t=tt(t,n,3);i--&&(n=r[i],!1!==t(e[n],n,e)););return e}function yt(e){var t=[];return v(e,function(e,n){wt(e)&&t.push(n)}),t.sort()}function bt(e){for(var t=-1,n=jn(e),r=n.length,i={};++t<r;){var s=n[t];i[e[s]]=s}return i}function wt(e){return typeof e=="function"}function Et(e){return!!e&&!!X[typeof e]}function St(e){return typeof e=="number"||e&&typeof e=="object"&&cn.call(e)==F||!1}function xt(e){return typeof e=="string"||e&&typeof e=="object"&&cn.call(e)==R||!1}function Tt(e){for(var t=-1,n=jn(e),r=n.length,i=Gt(r);++t<r;)i[t]=e[n[t]];return i}function Nt(e,t,n){var r=-1,i=ht(),s=e?e.length:0,o=!1;return n=(0>n?An(0,s+n):n)||0,Bn(e)?o=-1<i(e,t,n):typeof s=="number"?o=-1<(xt(e)?e.indexOf(t,n):i(e,t,n)):d(e,function(e){return++r<n?void 0:!(o=e===t)}),o}function Ct(e,t,n){var r=!0;t=K.createCallback(t,n,3),n=-1;var i=e?e.length:0;if(typeof i=="number")for(;++n<i&&(r=!!t(e[n],n,e)););else d(e,function(e,n,i){return r=!!t(e,n,i)});return r}function kt(e,t,n){var r=[];t=K.createCallback(t,n,3),n=-1;var i=e?e.length:0;if(typeof i=="number")for(;++n<i;){var s=e[n];t(s,n,e)&&r.push(s)}else d(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function Lt(e,t,n){t=K.createCallback(t,n,3),n=-1;var r=e?e.length:0;if(typeof r!="number"){var i;return d(e,function(e,n,r){return t(e,n,r)?(i=e,!1):void 0}),i}for(;++n<r;){var s=e[n];if(t(s,n,e))return s}}function At(e,t,n){var r=-1,i=e?e.length:0;if(t=t&&typeof n=="undefined"?t:tt(t,n,3),typeof i=="number")for(;++r<i&&!1!==t(e[r],r,e););else d(e,t);return e}function Ot(e,t,n){var r=e?e.length:0;if(t=t&&typeof n=="undefined"?t:tt(t,n,3),typeof r=="number")for(;r--&&!1!==t(e[r],r,e););else{var i=jn(e),r=i.length;d(e,function(e,n,s){return n=i?i[--r]:--r,t(s[n],n,s)})}return e}function Mt(e,t,n){var r=-1,i=e?e.length:0;if(t=K.createCallback(t,n,3),typeof i=="number")for(var s=Gt(i);++r<i;)s[r]=t(e[r],r,e);else s=[],d(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function _t(e,t,n){var i=-1/0,s=i;if(typeof t!="function"&&n&&n[t]===e&&(t=null),null==t&&Bn(e)){n=-1;for(var o=e.length;++n<o;){var u=e[n];u>s&&(s=u)}}else t=null==t&&xt(e)?r:K.createCallback(t,n,3),At(e,function(e,n,r){n=t(e,n,r),n>i&&(i=n,s=e)});return s}function Dt(e,t,n,r){if(!e)return n;var i=3>arguments.length;t=K.createCallback(t,r,4);var s=-1,o=e.length;if(typeof o=="number")for(i&&(n=e[++s]);++s<o;)n=t(n,e[s],s,e);else d(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function Pt(e,t,n,r){var i=3>arguments.length;return t=K.createCallback(t,r,4),Ot(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)}),n}function Ht(e){var t=-1,n=e?e.length:0,r=Gt(typeof n=="number"?n:0);return At(e,function(e){var n=ut(0,++t);r[t]=r[n],r[n]=e}),r}function Bt(e,t,n){var r;t=K.createCallback(t,n,3),n=-1;var i=e?e.length:0;if(typeof i=="number")for(;++n<i&&!(r=t(e[n],n,e)););else d(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function jt(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var s=-1;for(t=K.createCallback(t,n,3);++s<i&&t(e[s],s,e);)r++}else if(r=t,null==r||n)return e?e[0]:p;return c(e,0,On(An(0,r),i))}function Ft(t,n,r){if(typeof r=="number"){var i=t?t.length:0;r=0>r?An(0,i+r):r||0}else if(r)return r=qt(t,n),t[r]===n?r:-1;return e(t,n,r)}function It(e,t,n){if(typeof t!="number"&&null!=t){var r=0,i=-1,s=e?e.length:0;for(t=K.createCallback(t,n,3);++i<s&&t(e[i],i,e);)r++}else r=null==t||n?1:An(0,t);return c(e,r)}function qt(e,t,n,r){var i=0,s=e?e.length:i;for(n=n?K.createCallback(n,r,1):Vt,t=n(t);i<s;)r=i+s>>>1,n(e[r])<t?i=r+1:s=r;return i}function Rt(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),null!=n&&(n=K.createCallback(n,r,3)),at(e,t,n)}function Ut(){for(var e=1<arguments.length?arguments:arguments[0],t=-1,n=e?_t(Vn(e,"length")):0,r=Gt(0>n?0:n);++t<n;)r[t]=Vn(e,t);return r}function zt(e,t){var n=-1,r=e?e.length:0,i={};for(t||!r||Bn(e[0])||(t=[]);++n<r;){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function Wt(e,t){return 2<arguments.length?lt(e,17,c(arguments,2),null,t):lt(e,1,null,null,t)}function Xt(e,t,n){function r(){l&&dn(l),o=l=c=p,(v||d!==t)&&(h=$n(),u=e.apply(f,s),l||o||(s=f=null))}function i(){var n=t-($n()-a);0<n?l=wn(i,n):(o&&dn(o),n=c,o=l=c=p,n&&(h=$n(),u=e.apply(f,s),l||o||(s=f=null)))}var s,o,u,a,f,l,c,h=0,d=!1,v=!0;if(!wt(e))throw new un;if(t=An(0,t)||0,!0===n)var m=!0,v=!1;else Et(n)&&(m=n.leading,d="maxWait"in n&&(An(t,n.maxWait)||0),v="trailing"in n?n.trailing:v);return function(){if(s=arguments,a=$n(),f=this,c=v&&(l||!m),!1===d)var n=m&&!l;else{o||m||(h=a);var p=d-(a-h),g=0>=p;g?(o&&(o=dn(o)),h=a,u=e.apply(f,s)):o||(o=wn(r,p))}return g&&l?l=dn(l):l||t===d||(l=wn(i,t)),n&&(g=!0,u=e.apply(f,s)),!g||l||o||(s=f=null),u}}function Vt(e){return e}function $t(e,t,n){var r=!0,i=t&&yt(t);t&&(n||i.length)||(null==n&&(n=t),s=Q,t=e,e=K,i=yt(t)),!1===n?r=!1:Et(n)&&"chain"in n&&(r=n.chain);var s=e,o=wt(s);At(i,function(n){var i=e[n]=t[n];o&&(s.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,o=[n];if(bn.apply(o,arguments),o=i.apply(e,o),r||t){if(n===o&&Et(o))return this;o=new s(o),o.__chain__=t}return o})})}function Jt(){}function Kt(e){return function(t){return t[e]}}function Qt(){return this.__wrapped__}n=n?Y.defaults($.Object(),n,Y.pick($,_)):$;var Gt=n.Array,Yt=n.Boolean,Zt=n.Date,en=n.Function,tn=n.Math,nn=n.Number,rn=n.Object,sn=n.RegExp,on=n.String,un=n.TypeError,an=[],fn=rn.prototype,ln=n._,cn=fn.toString,hn=sn("^"+on(cn).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),pn=tn.ceil,dn=n.clearTimeout,vn=tn.floor,mn=en.prototype.toString,gn=pt(gn=rn.getPrototypeOf)&&gn,yn=fn.hasOwnProperty,bn=an.push,wn=n.setTimeout,En=an.splice,Sn=an.unshift,xn=function(){try{var e={},t=pt(t=rn.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),Tn=pt(Tn=rn.create)&&Tn,Nn=pt(Nn=Gt.isArray)&&Nn,Cn=n.isFinite,kn=n.isNaN,Ln=pt(Ln=rn.keys)&&Ln,An=tn.max,On=tn.min,Mn=n.parseInt,_n=tn.random,Dn={};Dn[P]=Gt,Dn[H]=Yt,Dn[B]=Zt,Dn[j]=en,Dn[I]=rn,Dn[F]=nn,Dn[q]=sn,Dn[R]=on,Q.prototype=K.prototype;var Pn=K.support={};Pn.funcDecomp=!pt(n.a)&&O.test(h),Pn.funcNames=typeof en.name=="string",K.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:k,variable:"",imports:{_:K}},Tn||(et=function(){function e(){}return function(t){if(Et(t)){e.prototype=t;var r=new e;e.prototype=null}return r||n.Object()}}());var Hn=xn?function(e,t){W.value=t,xn(e,"__bindData__",W)}:Jt,Bn=Nn||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&cn.call(e)==P||!1},jn=Ln?function(e){return Et(e)?Ln(e):[]}:J,Fn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},In=bt(Fn),qn=sn("("+jn(In).join("|")+")","g"),Rn=sn("["+jn(Fn).join("")+"]","g"),Un=gn?function(e){if(!e||cn.call(e)!=I)return!1;var t=e.valueOf,n=pt(t)&&(n=gn(t))&&gn(n);return n?e==n||gn(e)==n:dt(e)}:dt,zn=ft(function(e,t,n){yn.call(e,n)?e[n]++:e[n]=1}),Wn=ft(function(e,t,n){(yn.call(e,n)?e[n]:e[n]=[]).push(t)}),Xn=ft(function(e,t,n){e[n]=t}),Vn=Mt,$n=pt($n=Zt.now)&&$n||function(){return(new Zt).getTime()},Jn=8==Mn(w+"08")?Mn:function(e,t){return Mn(xt(e)?e.replace(L,""):e,t||0)};return K.after=function(e,t){if(!wt(t))throw new un;return function(){return 1>--e?t.apply(this,arguments):void 0}},K.assign=V,K.at=function(e){for(var t=arguments,n=-1,r=it(t,!0,!1,1),t=t[2]&&t[2][t[1]]===e?1:r.length,i=Gt(t);++n<t;)i[n]=e[r[n]];return i},K.bind=Wt,K.bindAll=function(e){for(var t=1<arguments.length?it(arguments,!0,!1,1):yt(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=lt(e[i],1,null,null,e)}return e},K.bindKey=function(e,t){return 2<arguments.length?lt(t,19,c(arguments,2),null,e):lt(t,3,null,null,e)},K.chain=function(e){return e=new Q(e),e.__chain__=!0,e},K.compact=function(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r},K.compose=function(){for(var e=arguments,t=e.length;t--;)if(!wt(e[t]))throw new un;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},K.constant=function(e){return function(){return e}},K.countBy=zn,K.create=function(e,t){var n=et(e);return t?V(n,t):n},K.createCallback=function(e,t,n){var r=typeof e;if(null==e||"function"==r)return tt(e,t,n);if("object"!=r)return Kt(e);var i=jn(e),s=i[0],o=e[s];return 1!=i.length||o!==o||Et(o)?function(t){for(var n=i.length,r=!1;n--&&(r=st(t[i[n]],e[i[n]],null,!0)););return r}:function(e){return e=e[s],o===e&&(0!==o||1/o==1/e)}},K.curry=function(e,t){return t=typeof t=="number"?t:+t||e.length,lt(e,4,null,null,null,t)},K.debounce=Xt,K.defaults=b,K.defer=function(e){if(!wt(e))throw new un;var t=c(arguments,1);return wn(function(){e.apply(p,t)},1)},K.delay=function(e,t){if(!wt(e))throw new un;var n=c(arguments,2);return wn(function(){e.apply(p,n)},t)},K.difference=function(e){return rt(e,it(arguments,!0,!0,1))},K.filter=kt,K.flatten=function(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),null!=n&&(e=Mt(e,n,r)),it(e,t)},K.forEach=At,K.forEachRight=Ot,K.forIn=v,K.forInRight=function(e,t,n){var r=[];v(e,function(e,t){r.push(t,e)});var i=r.length;for(t=tt(t,n,3);i--&&!1!==t(r[i--],r[i],e););return e},K.forOwn=d,K.forOwnRight=gt,K.functions=yt,K.groupBy=Wn,K.indexBy=Xn,K.initial=function(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var s=i;for(t=K.createCallback(t,n,3);s--&&t(e[s],s,e);)r++}else r=null==t||n?1:t||r;return c(e,0,On(An(0,i-r),i))},K.intersection=function(){for(var n=[],r=-1,i=arguments.length,o=u(),a=ht(),c=a===e,h=u();++r<i;){var p=arguments[r];(Bn(p)||mt(p))&&(n.push(p),o.push(c&&p.length>=y&&s(r?n[r]:h)))}var c=n[0],d=-1,v=c?c.length:0,m=[];e:for(;++d<v;){var g=o[0],p=c[d];if(0>(g?t(g,p):a(h,p))){for(r=i,(g||h).push(p);--r;)if(g=o[r],0>(g?t(g,p):a(n[r],p)))continue e;m.push(p)}}for(;i--;)(g=o[i])&&l(g);return f(o),f(h),m},K.invert=bt,K.invoke=function(e,t){var n=c(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Gt(typeof s=="number"?s:0);return At(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o},K.keys=jn,K.map=Mt,K.mapValues=function(e,t,n){var r={};return t=K.createCallback(t,n,3),d(e,function(e,n,i){r[n]=t(e,n,i)}),r},K.max=_t,K.memoize=function(e,t){function n(){var r=n.cache,i=t?t.apply(this,arguments):g+arguments[0];return yn.call(r,i)?r[i]:r[i]=e.apply(this,arguments)}if(!wt(e))throw new un;return n.cache={},n},K.merge=function(e){var t=arguments,n=2;if(!Et(e))return e;if("number"!=typeof t[2]&&(n=t.length),3<n&&"function"==typeof t[n-2])var r=tt(t[--n-1],t[n--],2);else 2<n&&"function"==typeof t[n-1]&&(r=t[--n]);for(var t=c(arguments,1,n),i=-1,s=u(),o=u();++i<n;)ot(e,t[i],r,s,o);return f(s),f(o),e},K.min=function(e,t,n){var i=1/0,s=i;if(typeof t!="function"&&n&&n[t]===e&&(t=null),null==t&&Bn(e)){n=-1;for(var o=e.length;++n<o;){var u=e[n];u<s&&(s=u)}}else t=null==t&&xt(e)?r:K.createCallback(t,n,3),At(e,function(e,n,r){n=t(e,n,r),n<i&&(i=n,s=e)});return s},K.omit=function(e,t,n){var r={};if(typeof t!="function"){var i=[];v(e,function(e,t){i.push(t)});for(var i=rt(i,it(arguments,!0,!1,1)),s=-1,o=i.length;++s<o;){var u=i[s];r[u]=e[u]}}else t=K.createCallback(t,n,3),v(e,function(e,n,i){t(e,n,i)||(r[n]=e)});return r},K.once=function(e){var t,n;if(!wt(e))throw new un;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},K.pairs=function(e){for(var t=-1,n=jn(e),r=n.length,i=Gt(r);++t<r;){var s=n[t];i[t]=[s,e[s]]}return i},K.partial=function(e){return lt(e,16,c(arguments,1))},K.partialRight=function(e){return lt(e,32,null,c(arguments,1))},K.pick=function(e,t,n){var r={};if(typeof t!="function")for(var i=-1,s=it(arguments,!0,!1,1),o=Et(e)?s.length:0;++i<o;){var u=s[i];u in e&&(r[u]=e[u])}else t=K.createCallback(t,n,3),v(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r},K.pluck=Vn,K.property=Kt,K.pull=function(e){for(var t=arguments,n=0,r=t.length,i=e?e.length:0;++n<r;)for(var s=-1,o=t[n];++s<i;)e[s]===o&&(En.call(e,s--,1),i--);return e},K.range=function(e,t,n){e=+e||0,n=typeof n=="number"?n:+n||1,null==t&&(t=e,e=0);var r=-1;t=An(0,pn((t-e)/(n||1)));for(var i=Gt(t);++r<t;)i[r]=e,e+=n;return i},K.reject=function(e,t,n){return t=K.createCallback(t,n,3),kt(e,function(e,n,r){return!t(e,n,r)})},K.remove=function(e,t,n){var r=-1,i=e?e.length:0,s=[];for(t=K.createCallback(t,n,3);++r<i;)n=e[r],t(n,r,e)&&(s.push(n),En.call(e,r--,1),i--);return s},K.rest=It,K.shuffle=Ht,K.sortBy=function(e,t,n){var r=-1,s=Bn(t),o=e?e.length:0,c=Gt(typeof o=="number"?o:0);for(s||(t=K.createCallback(t,n,3)),At(e,function(e,n,i){var o=c[++r]=a();s?o.m=Mt(t,function(t){return e[t]}):(o.m=u())[0]=t(e,n,i),o.n=r,o.o=e}),o=c.length,c.sort(i);o--;)e=c[o],c[o]=e.o,s||f(e.m),l(e);return c},K.tap=function(e,t){return t(e),e},K.throttle=function(e,t,n){var r=!0,i=!0;if(!wt(e))throw new un;return!1===n?r=!1:Et(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),z.leading=r,z.maxWait=t,z.trailing=i,Xt(e,t,z)},K.times=function(e,t,n){e=-1<(e=+e)?e:0;var r=-1,i=Gt(e);for(t=tt(t,n,1);++r<e;)i[r]=t(r);return i},K.toArray=function(e){return e&&typeof e.length=="number"?c(e):Tt(e)},K.transform=function(e,t,n,r){var i=Bn(e);if(null==n)if(i)n=[];else{var s=e&&e.constructor;n=et(s&&s.prototype)}return t&&(t=K.createCallback(t,r,4),(i?At:d)(e,function(e,r,i){return t(n,e,r,i)})),n},K.union=function(){return at(it(arguments,!0,!0))},K.uniq=Rt,K.values=Tt,K.where=kt,K.without=function(e){return rt(e,c(arguments,1))},K.wrap=function(e,t){return lt(t,16,[e])},K.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Bn(n)||mt(n))var r=r?at(rt(r,n).concat(rt(n,r))):n}return r||[]},K.zip=Ut,K.zipObject=zt,K.collect=Mt,K.drop=It,K.each=At,K.eachRight=Ot,K.extend=V,K.methods=yt,K.object=zt,K.select=kt,K.tail=It,K.unique=Rt,K.unzip=Ut,$t(K),K.clone=function(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=t,t=!1),Z(e,t,typeof n=="function"&&tt(n,r,1))},K.cloneDeep=function(e,t,n){return Z(e,!0,typeof t=="function"&&tt(t,n,1))},K.contains=Nt,K.escape=function(e){return null==e?"":on(e).replace(Rn,ct)},K.every=Ct,K.find=Lt,K.findIndex=function(e,t,n){var r=-1,i=e?e.length:0;for(t=K.createCallback(t,n,3);++r<i;)if(t(e[r],r,e))return r;return-1},K.findKey=function(e,t,n){var r;return t=K.createCallback(t,n,3),d(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r},K.findLast=function(e,t,n){var r;return t=K.createCallback(t,n,3),Ot(e,function(e,n,i){return t(e,n,i)?(r=e,!1):void 0}),r},K.findLastIndex=function(e,t,n){var r=e?e.length:0;for(t=K.createCallback(t,n,3);r--;)if(t(e[r],r,e))return r;return-1},K.findLastKey=function(e,t,n){var r;return t=K.createCallback(t,n,3),gt(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r},K.has=function(e,t){return e?yn.call(e,t):!1},K.identity=Vt,K.indexOf=Ft,K.isArguments=mt,K.isArray=Bn,K.isBoolean=function(e){return!0===e||!1===e||e&&typeof e=="object"&&cn.call(e)==H||!1},K.isDate=function(e){return e&&typeof e=="object"&&cn.call(e)==B||!1},K.isElement=function(e){return e&&1===e.nodeType||!1},K.isEmpty=function(e){var t=!0;if(!e)return t;var n=cn.call(e),r=e.length;return n==P||n==R||n==D||n==I&&typeof r=="number"&&wt(e.splice)?!r:(d(e,function(){return t=!1}),t)},K.isEqual=function(e,t,n,r){return st(e,t,typeof n=="function"&&tt(n,r,2))},K.isFinite=function(e){return Cn(e)&&!kn(parseFloat(e))},K.isFunction=wt,K.isNaN=function(e){return St(e)&&e!=+e},K.isNull=function(e){return null===e},K.isNumber=St,K.isObject=Et,K.isPlainObject=Un,K.isRegExp=function(e){return e&&typeof e=="object"&&cn.call(e)==q||!1},K.isString=xt,K.isUndefined=function(e){return typeof e=="undefined"},K.lastIndexOf=function(e,t,n){var r=e?e.length:0;for(typeof n=="number"&&(r=(0>n?An(0,r+n):On(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},K.mixin=$t,K.noConflict=function(){return n._=ln,this},K.noop=Jt,K.now=$n,K.parseInt=Jn,K.random=function(e,t,n){var r=null==e,i=null==t;return null==n&&(typeof e=="boolean"&&i?(n=e,e=1):i||typeof t!="boolean"||(n=t,i=!0)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1?(n=_n(),On(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)):ut(e,t)},K.reduce=Dt,K.reduceRight=Pt,K.result=function(e,t){if(e){var n=e[t];return wt(n)?e[t]():n}},K.runInContext=h,K.size=function(e){var t=e?e.length:0;return typeof t=="number"?t:jn(e).length},K.some=Bt,K.sortedIndex=qt,K.template=function(e,t,n){var r=K.templateSettings;e=on(e||""),n=b({},n,r);var i,s=b({},n.imports,r.imports),r=jn(s),s=Tt(s),u=0,a=n.interpolate||A,f="__p+='",a=sn((n.escape||A).source+"|"+a.source+"|"+(a===k?T:A).source+"|"+(n.evaluate||A).source+"|$","g");e.replace(a,function(t,n,r,s,a,l){return r||(r=s),f+=e.slice(u,l).replace(M,o),n&&(f+="'+__e("+n+")+'"),a&&(i=!0,f+="';"+a+";\n__p+='"),r&&(f+="'+((__t=("+r+"))==null?'':__t)+'"),u=l+t.length,t}),f+="';",a=n=n.variable,a||(n="obj",f="with("+n+"){"+f+"}"),f=(i?f.replace(E,""):f).replace(S,"$1").replace(x,"$1;"),f="function("+n+"){"+(a?"":n+"||("+n+"={});")+"var __t,__p='',__e=_.escape"+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+f+"return __p}";try{var l=en(r,"return "+f).apply(p,s)}catch(c){throw c.source=f,c}return t?l(t):(l.source=f,l)},K.unescape=function(e){return null==e?"":on(e).replace(qn,vt)},K.uniqueId=function(e){var t=++m;return on(null==e?"":e)+t},K.all=Ct,K.any=Bt,K.detect=Lt,K.findWhere=Lt,K.foldl=Dt,K.foldr=Pt,K.include=Nt,K.inject=Dt,$t(function(){var e={};return d(K,function(t,n){K.prototype[n]||(e[n]=t)}),e}(),!1),K.first=jt,K.last=function(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var s=i;for(t=K.createCallback(t,n,3);s--&&t(e[s],s,e);)r++}else if(r=t,null==r||n)return e?e[i-1]:p;return c(e,An(0,i-r))},K.sample=function(e,t,n){return e&&typeof e.length!="number"&&(e=Tt(e)),null==t||n?e?e[ut(0,e.length-1)]:p:(e=Ht(e),e.length=On(An(0,t),e.length),e)},K.take=jt,K.head=jt,d(K,function(e,t){var n="sample"!==t;K.prototype[t]||(K.prototype[t]=function(t,r){var i=this.__chain__,s=e(this.__wrapped__,t,r);return i||null!=t&&(!r||n&&typeof t=="function")?new Q(s,i):s})}),K.VERSION="2.4.1",K.prototype.chain=function(){return this.__chain__=!0,this},K.prototype.toString=function(){return on(this.__wrapped__)},K.prototype.value=Qt,K.prototype.valueOf=Qt,At(["join","pop","shift"],function(e){var t=an[e];K.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new Q(n,e):n}}),At(["push","reverse","sort","unshift"],function(e){var t=an[e];K.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),At(["concat","slice","splice"],function(e){var t=an[e];K.prototype[e]=function(){return new Q(t.apply(this.__wrapped__,arguments),this.__chain__)}}),K}var p,d=[],v=[],m=0,g=+(new Date)+"",y=75,b=40,w=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",E=/\b__p\+='';/g,S=/\b(__p\+=)''\+/g,x=/(__e\(.*?\)|\b__t\))\+'';/g,T=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,N=/\w*$/,C=/^\s*function[ \n\r\t]+\w/,k=/<%=([\s\S]+?)%>/g,L=RegExp("^["+w+"]*0+(?=.$)"),A=/($^)/,O=/\bthis\b/,M=/['\n\r\t\u2028\u2029\\]/g,_="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",P="[object Array]",H="[object Boolean]",B="[object Date]",j="[object Function]",F="[object Number]",I="[object Object]",q="[object RegExp]",R="[object String]",U={};U[j]=!1,U[D]=U[P]=U[H]=U[B]=U[F]=U[I]=U[q]=U[R]=!0;var z={leading:!1,maxWait:0,trailing:!1},W={configurable:!1,enumerable:!1,value:null,writable:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},V={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},$=X[typeof window]&&window||this,J=X[typeof exports]&&exports&&!exports.nodeType&&exports,K=X[typeof module]&&module&&!module.nodeType&&module,Q=K&&K.exports===J&&J,G=X[typeof global]&&global;!G||G.global!==G&&G.window!==G||($=G);var Y=h();typeof define=="function"&&typeof define.amd=="object"&&define.amd?($._=Y,define("underscore",[],function(){return Y})):J&&K?Q?(K.exports=Y)._=Y:J._=Y:$._=Y}.call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),!function(e){if("object"==typeof exports)module.exports=e(require("underscore"),require("backbone"));else if("function"==typeof define&&define.amd)define("backbone-paginator",["underscore","backbone"],e);else if("undefined"!=typeof _&&"undefined"!=typeof Backbone){var t=Backbone.PageableCollection,n=e(_,Backbone);Backbone.PageableCollection.noConflict=function(){return Backbone.PageableCollection=t,n}}}(function(e,t){function n(t,n){if(!e.isNumber(t)||e.isNaN(t)||!e.isFinite(t)||~~t!==t)throw new TypeError("`"+n+"` must be a finite integer");return t}function r(e){for(var t,n,r,i,s={},o=decodeURIComponent,u=e.split("&"),a=0,f=u.length;f>a;a++){var l=u[a];t=l.split("="),n=t[0],r=t[1]||!0,n=o(n),r=o(r),i=s[n],d(i)?i.push(r):s[n]=i?[i,r]:r}return s}function i(e,t,n){var r=e._events[t];if(r&&r.length){var i=r[r.length-1],s=i.callback;i.callback=function(){try{s.apply(this,arguments),n()}catch(e){throw e}finally{i.callback=s}}}else n()}var s=e.extend,o=e.omit,u=e.clone,a=e.each,f=e.pick,l=e.contains,c=e.isEmpty,h=e.pairs,p=e.invert,d=e.isArray,v=e.isFunction,m=e.isObject,g=e.keys,y=e.isUndefined,b=e.result,w=Math.ceil,E=Math.floor,S=Math.max,x=t.Collection.prototype,T=/[\s'"]/g,N=/[<>\s'"]/g,C=t.PageableCollection=t.Collection.extend({state:{firstPage:1,lastPage:null,currentPage:null,pageSize:25,totalPages:null,totalRecords:null,sortKey:null,order:-1},mode:"server",queryParams:{currentPage:"page",pageSize:"per_page",totalPages:"total_pages",totalRecords:"total_entries",sortKey:"sort_by",order:"order",directions:{"-1":"asc",1:"desc"}},constructor:function(e,t){x.constructor.apply(this,arguments),t=t||{};var n=this.mode=t.mode||this.mode||k.mode,r=s({},k.queryParams,this.queryParams,t.queryParams||{});r.directions=s({},k.queryParams.directions,this.queryParams.directions,r.directions||{}),this.queryParams=r;var i=this.state=s({},k.state,this.state,t.state||{});i.currentPage=null==i.currentPage?i.firstPage:i.currentPage,d(e)||(e=e?[e]:[]),e=e.slice(),"server"==n||null!=i.totalRecords||c(e)||(i.totalRecords=e.length),this.switchMode(n,s({fetch:!1,resetState:!1,models:e},t));var o=t.comparator;if(i.sortKey&&!o&&this.setSorting(i.sortKey,i.order,t),"server"!=n){var a=this.fullCollection;o&&t.full&&(this.comparator=null,a.comparator=o),t.full&&a.sort(),e&&!c(e)&&(this.reset(e,s({silent:!0},t)),this.getPage(i.currentPage),e.splice.apply(e,[0,e.length].concat(this.models)))}this._initState=u(this.state)},_makeFullCollection:function(e,n){var r,i,s,o=["url","model","sync","comparator"],u=this.constructor.prototype,a={};for(r=0,i=o.length;i>r;r++)s=o[r],y(u[s])||(a[s]=u[s]);var f=new(t.Collection.extend(a))(e,n);for(r=0,i=o.length;i>r;r++)s=o[r],this[s]!==u[s]&&(f[s]=this[s]);return f},_makeCollectionEventHandler:function(e,t){return function(n,r,o,f){var l=e._handlers;a(g(l),function(n){var r=l[n];e.off(n,r),t.off(n,r)});var c=u(e.state),h=c.firstPage,p=0===h?c.currentPage:c.currentPage-1,d=c.pageSize,v=p*d,m=v+d;if("add"==n){var b,E,S,x,f=f||{};if(o==t)E=t.indexOf(r),E>=v&&m>E&&(x=e,b=S=E-v);else{b=e.indexOf(r),E=v+b,x=t;var S=y(f.at)?E:f.at+v}if(f.onRemove||(++c.totalRecords,delete f.onRemove),e.state=e._checkState(c),x){x.add(r,s({},f||{},{at:S}));var T=b>=d?r:!y(f.at)&&m>S&&e.length>d?e.at(d):null;T&&i(o,n,function(){e.remove(T,{onAdd:!0})})}}if("remove"==n)if(f.onAdd)delete f.onAdd;else{if(--c.totalRecords){var N=c.totalPages=w(c.totalRecords/d);c.lastPage=0===h?N-1:N||h,c.currentPage>N&&(c.currentPage=c.lastPage)}else c.totalRecords=null,c.totalPages=null;e.state=e._checkState(c);var C,k=f.index;o==e?((C=t.at(m))&&i(e,n,function(){e.push(C,{onRemove:!0})}),t.remove(r)):k>=v&&m>k&&((C=t.at(m-1))&&i(e,n,function(){e.push(C,{onRemove:!0})}),e.remove(r))}if("reset"==n)if(f=o,o=r,o==e&&null==f.from&&null==f.to){var L=t.models.slice(0,v),A=t.models.slice(v+e.models.length);t.reset(L.concat(e.models).concat(A),f)}else o==t&&((c.totalRecords=t.models.length)||(c.totalRecords=null,c.totalPages=null),"client"==e.mode&&(c.lastPage=c.currentPage=c.firstPage),e.state=e._checkState(c),e.reset(t.models.slice(v,m),s({},f,{parse:!1})));"sort"==n&&(f=o,o=r,o===t&&e.reset(t.models.slice(v,m),s({},f,{parse:!1}))),a(g(l),function(n){var r=l[n];a([e,t],function(e){e.on(n,r);var t=e._events[n]||[];t.unshift(t.pop())})})}},_checkState:function(e){var t=this.mode,r=this.links,i=e.totalRecords,s=e.pageSize,o=e.currentPage,u=e.firstPage,a=e.totalPages;if(null!=i&&null!=s&&null!=o&&null!=u&&("infinite"==t?r:!0)){if(i=n(i,"totalRecords"),s=n(s,"pageSize"),o=n(o,"currentPage"),u=n(u,"firstPage"),1>s)throw new RangeError("`pageSize` must be >= 1");if(a=e.totalPages=w(i/s),0>u||u>1)throw new RangeError("`firstPage must be 0 or 1`");if(e.lastPage=0===u?S(0,a-1):a||u,"infinite"==t){if(!r[o+""])throw new RangeError("No link found for page "+o)}else if(u>o||a>0&&(u?o>a:o>=a))throw new RangeError("`currentPage` must be firstPage <= currentPage "+(u?">":">=")+" totalPages if "+u+"-based. Got "+o+".")}return e},setPageSize:function(e,t){e=n(e,"pageSize"),t=t||{first:!1};var r=this.state,i=w(r.totalRecords/e),u=i?S(r.firstPage,E(i*r.currentPage/r.totalPages)):r.firstPage;return r=this.state=this._checkState(s({},r,{pageSize:e,currentPage:t.first?r.firstPage:u,totalPages:i})),this.getPage(r.currentPage,o(t,["first"]))},switchMode:function(t,n){if(!l(["server","client","infinite"],t))throw new TypeError('`mode` must be one of "server", "client" or "infinite"');n=n||{fetch:!0,resetState:!0};var r=this.state=n.resetState?u(this._initState):this._checkState(s({},this.state));this.mode=t;var i,f=this,c=this.fullCollection,h=this._handlers=this._handlers||{};if("server"==t||c)"server"==t&&c&&(a(g(h),function(e){i=h[e],f.off(e,i),c.off(e,i)}),delete this._handlers,this._fullComparator=c.comparator,delete this.fullCollection);else{c=this._makeFullCollection(n.models||[],n),c.pageableCollection=this,this.fullCollection=c;var p=this._makeCollectionEventHandler(this,c);a(["add","remove","reset","sort"],function(t){h[t]=i=e.bind(p,{},t),f.on(t,i),c.on(t,i)}),c.comparator=this._fullComparator}if("infinite"==t)for(var d=this.links={},v=r.firstPage,m=w(r.totalRecords/r.pageSize),y=0===v?S(0,m-1):m||v,b=r.firstPage;y>=b;b++)d[b]=this.url;else this.links&&delete this.links;return n.fetch?this.fetch(o(n,"fetch","resetState")):this},hasPreviousPage:function(){var e=this.state,t=e.currentPage;return"infinite"!=this.mode?t>e.firstPage:!!this.links[t-1]},hasNextPage:function(){var e=this.state,t=this.state.currentPage;return"infinite"!=this.mode?t<e.lastPage:!!this.links[t+1]},getFirstPage:function(e){return this.getPage("first",e)},getPreviousPage:function(e){return this.getPage("prev",e)},getNextPage:function(e){return this.getPage("next",e)},getLastPage:function(e){return this.getPage("last",e)},getPage:function(e,t){var r=this.mode,i=this.fullCollection;t=t||{fetch:!1};var u=this.state,a=u.firstPage,f=u.currentPage,l=u.lastPage,h=u.pageSize,p=e;switch(e){case"first":p=a;break;case"prev":p=f-1;break;case"next":p=f+1;break;case"last":p=l;break;default:p=n(e,"index")}this.state=this._checkState(s({},u,{currentPage:p})),t.from=f,t.to=p;var d=(0===a?p:p-1)*h,v=i&&i.length?i.models.slice(d,d+h):[];return"client"!=r&&("infinite"!=r||c(v))||t.fetch?("infinite"==r&&(t.url=this.links[p]),this.fetch(o(t,"fetch"))):(this.reset(v,o(t,"fetch")),this)},getPageByOffset:function(e,t){if(0>e)throw new RangeError("`offset must be > 0`");e=n(e);var r=E(e/this.state.pageSize);return 0!==this.state.firstPage&&r++,r>this.state.lastPage&&(r=this.state.lastPage),this.getPage(r,t)},sync:function(e,n,r){var i=this;if("infinite"==i.mode){var o=r.success,u=i.state.currentPage;r.success=function(e,t,n){var a=i.links,f=i.parseLinks(e,s({xhr:n},r));f.first&&(a[i.state.firstPage]=f.first),f.prev&&(a[u-1]=f.prev),f.next&&(a[u+1]=f.next),o&&o(e,t,n)}}return(x.sync||t.sync).call(i,e,n,r)},parseLinks:function(e,t){var n={},r=t.xhr.getResponseHeader("Link");if(r){var i=["first","prev","next"];a(r.split(","),function(e){var t=e.split(";"),r=t[0].replace(N,""),s=t.slice(1);a(s,function(e){var t=e.split("="),s=t[0].replace(T,""),o=t[1].replace(T,"");"rel"==s&&l(i,o)&&(n[o]=r)})})}return n},parse:function(e,t){var n=this.parseState(e,u(this.queryParams),u(this.state),t);return n&&(this.state=this._checkState(s({},this.state,n))),this.parseRecords(e,t)},parseState:function(t,n,r){if(t&&2===t.length&&m(t[0])&&d(t[1])){var i=u(r),s=t[0];return a(h(o(n,"directions")),function(t){var n=t[0],r=t[1],o=s[r];y(o)||e.isNull(o)||(i[n]=s[r])}),s.order&&(i.order=1*p(n.directions)[s.order]),i}},parseRecords:function(e){return e&&2===e.length&&m(e[0])&&d(e[1])?e[1]:e},fetch:function(e){e=e||{};var t=this._checkState(this.state),n=this.mode;"infinite"!=n||e.url||(e.url=this.links[t.currentPage]);var i=e.data||{},a=b(e,"url")||b(this,"url")||"",l=a.indexOf("?");-1!=l&&(s(i,r(a.slice(l+1))),a=a.slice(0,l)),e.url=a,e.data=i;var c,p,d,m,w="client"==this.mode?f(this.queryParams,"sortKey","order"):o(f(this.queryParams,g(k.queryParams)),"directions"),E=h(w),S=u(this);for(c=0;c<E.length;c++)p=E[c],d=p[0],m=p[1],m=v(m)?m.call(S):m,null!=t[d]&&null!=m&&(i[m]=t[d]);t.sortKey&&t.order?i[w.order]=this.queryParams.directions[t.order+""]:t.sortKey||delete i[w.order];var T=h(o(this.queryParams,g(k.queryParams)));for(c=0;c<T.length;c++)p=T[c],m=p[1],m=v(m)?m.call(S):m,null!=m&&(i[p[0]]=m);if("server"!=n){var N=this,C=this.fullCollection,L=e.success;return e.success=function(t,r,i){i=i||{},y(e.silent)?delete i.silent:i.silent=e.silent;var o=t.models;"client"==n?C.reset(o,i):(C.add(o,s({at:C.length},s(i,{parse:!1}))),N.trigger("reset",N,i)),L&&L(t,r,i)},x.fetch.call(this,s({},e,{silent:!0}))}return x.fetch.call(this,e)},_makeComparator:function(e,t,n){var r=this.state;return e=e||r.sortKey,t=t||r.order,e&&t?(n||(n=function(e,t){return e.get(t)}),function(r,i){var s,o=n(r,e),u=n(i,e);return 1===t&&(s=o,o=u,u=s),o===u?0:u>o?-1:1}):void 0},setSorting:function(e,t,n){var r=this.state;r.sortKey=e,r.order=t=t||r.order;var i=this.fullCollection,o=!1,u=!1;e||(o=u=!0);var a=this.mode;n=s({side:"client"==a?a:"server",full:!0},n);var f=this._makeComparator(e,t,n.sortValue),l=n.full,c=n.side;return"client"==c?l?(i&&(i.comparator=f),o=!0):(this.comparator=f,u=!0):"server"!=c||l||(this.comparator=f),o&&(this.comparator=null),u&&i&&(i.comparator=null),this}}),k=C.prototype;return C}),function(e,t){typeof define=="function"&&define.amd?define("backbone-indexeddb",["backbone","underscore"],t):typeof exports=="object"?module.exports=t(require("backbone"),require("underscore")):e.returnExports=t(e.Backbone,e._)}(this,function(e,t){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}function r(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function u(e,n,r){this.schema=e,this.ready=n,this.error=null,this.transactions=[],this.db=null,this.nolog=r,this.supportOnUpgradeNeeded=!1;var s=t.last(this.schema.migrations).version;this.nolog||a("opening database "+this.schema.id+" in version #"+s),this.dbRequest=i.open(this.schema.id,s),this.launchMigrationPath=function(n){var r=this.dbRequest.transaction||versionRequest.result,i=t.clone(e.migrations);this.migrate(r,i,n,{success:function(){this.ready()}.bind(this),error:function(){this.error="Database not up to date. "+n+" expected was "+s}.bind(this)})},this.dbRequest.onblocked=function(e){this.nolog||a("blocked")},this.dbRequest.onsuccess=function(e){this.db=e.target.result;if(!this.supportOnUpgradeNeeded){var t=parseInt(this.db.version)||0,n=parseInt(s)||0;t===n?this.ready():t<n?this.launchMigrationPath(t):this.error="Database version is greater than current code "+t+" expected was "+n}}.bind(this),this.dbRequest.onerror=function(e){this.error="Couldn't not connect to the database"}.bind(this),this.dbRequest.onabort=function(e){this.error="Connection to the database aborted"}.bind(this),this.dbRequest.onupgradeneeded=function(e){this.db=e.target.transaction.db,this.supportOnUpgradeNeeded=!0,this.nolog||a("onupgradeneeded = "+e.oldVersion+" => "+e.newVersion),this.launchMigrationPath(e.oldVersion)}.bind(this)}function a(e){typeof window!="undefined"&&typeof window.console!="undefined"&&typeof window.console.log!="undefined"?window.console.log(e):console.log!=="undefined"&&console.log(e)}function f(e,n,r){this.driver=new u(e,this.ready.bind(this),r),this.started=!1,this.stack=[],this.version=t.last(e.migrations).version,this.next=n}function c(n,r,i){if(n=="closeall"){t.each(l,function(e){e.close()}),l={};return}if(typeof r.database=="undefined"&&typeof e.ajaxSync=="function")return e.ajaxSync(n,r,i);var s=r.database;l[s.id]&&l[s.id].version!=t.last(s.migrations).version&&(l[s.id].close(),delete l[s.id]);var o;if(typeof e.$=="undefined"||typeof e.$.Deferred=="undefined")var u=function(){},a=u,c=u;else{var h=e.$.Deferred(),a=h.resolve,c=h.reject;o=h.promise()}var p=i.success;i.success=function(e){p&&p(e),a(),r.trigger("sync",r,e,i)};var d=i.error;i.error=function(e){d&&d(e),c(),r.trigger("error",r,e,i)};var v=function(){l[s.id].execute([n,r,i])};return l[s.id]?v():l[s.id]=new f(s,v,s.nolog),o}var i=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,s=window.IDBTransaction||window.webkitIDBTransaction||{READ_WRITE:"readwrite"},o=window.IDBKeyRange||window.webkitIDBKeyRange;window.IDBCursor=window.IDBCursor||window.webkitIDBCursor||window.mozIDBCursor||window.msIDBCursor;if(t(i).isUndefined())return;u.prototype={_track_transaction:function(e){function t(){var t=this.transactions.indexOf(e);t!==-1&&this.transactions.splice(t)}this.transactions.push(e),e.oncomplete=t.bind(this),e.onabort=t.bind(this),e.onerror=t.bind(this)},migrate:function(e,t,n,r){this.nolog||a("migrate begin version from #"+n);var i=this,s=t.shift();s&&(!n||n<s.version?(typeof s.before=="undefined"&&(s.before=function(e){e()}),typeof s.after=="undefined"&&(s.after=function(e){e()}),this.nolog||a("migrate begin before version #"+s.version),s.before(function(){this.nolog||a("migrate done before version #"+s.version);var o=function(o){this.nolog||a("migrate begin migrate version #"+s.version),s.migrate(e,function(){this.nolog||a("migrate done migrate version #"+s.version),this.nolog||a("migrate begin after version #"+s.version),s.after(function(){this.nolog||a("migrate done after version #"+s.version),this.nolog||a("Migrated to "+s.version),t.length==0?(this.nolog||a("migrate setting transaction.oncomplete to finish  version #"+s.version),e.oncomplete=function(){i.nolog||a("migrate done transaction.oncomplete version #"+s.version),i.nolog||a("Done migrating"),r.success()}):(this.nolog||a("migrate end from version #"+n+" to "+s.version),i.migrate(e,t,n,r))}.bind(this))}.bind(this))}.bind(this);if(!this.supportOnUpgradeNeeded){this.nolog||a("migrate begin setVersion version #"+s.version);var u=this.db.setVersion(s.version);u.onsuccess=o,u.onerror=r.error}else o()}.bind(this))):(this.nolog||a("Skipping migration "+s.version),this.migrate(e,t,n,r)))},execute:function(e,t,n,r){this.nolog||a("execute : "+t+" on "+e+" for "+n.id);switch(t){case"create":this.create(e,n,r);break;case"read":n.id||n.cid?this.read(e,n,r):this.query(e,n,r);break;case"update":this.update(e,n,r);break;case"delete":n.id||n.cid?this.delete(e,n,r):this.clear(e,n,r);break;default:}},create:function(e,t,n){var i=this.db.transaction([e],"readwrite"),s=i.objectStore(e),o=t.toJSON(),u;o.id===undefined&&!s.autoIncrement&&(o.id=r()),i.onerror=function(e){n.error(e)},i.oncomplete=function(e){n.success(o)},s.keyPath?u=s.add(o):u=s.add(o,o.id)},update:function(e,t,n){var i=this.db.transaction([e],"readwrite"),s=i.objectStore(e),o=t.toJSON(),u;o.id||(o.id=r()),s.keyPath?u=s.put(o):u=s.put(o,o.id),u.onerror=function(e){n.error(e)},i.oncomplete=function(e){n.success(o)}},read:function(e,n,r){var i=this.db.transaction([e],"readonly");this._track_transaction(i);var s=i.objectStore(e),o=n.toJSON(),u=null;if(o.id)u=s.get(o.id);else if(r.index){var a=s.index(r.index.name);u=a.get(r.index.value)}else{var f=0;t.each(s.indexNames,function(e,n){n=s.index(e);if(typeof n.keyPath=="string"&&1>f)o[n.keyPath]!==undefined&&(u=n.get(o[n.keyPath]),f=1);else if(typeof n.keyPath=="object"&&n.keyPath.length>f){var r=!0,i=t.map(n.keyPath,function(e){return r=r&&o[e]!==undefined,o[e]});r&&(u=n.get(i),f=n.keyPath.length)}})}u?(u.onsuccess=function(e){e.target.result?r.success(e.target.result):r.error("Not Found")},u.onerror=function(){r.error("Not Found")}):r.error("Not Found")},"delete":function(e,t,n){var r=this.db.transaction([e],"readwrite"),i=r.objectStore(e),s=t.toJSON(),o=i.delete(s.id);r.oncomplete=function(e){n.success(null)},o.onerror=function(e){n.error("Not Deleted")}},clear:function(e,t,n){var r=this.db.transaction([e],"readwrite"),i=r.objectStore(e),s=i.clear();s.onsuccess=function(e){n.success(null)},s.onerror=function(e){n.error("Not Cleared")}},query:function(e,n,r){var i=[],s=0,u=0,a=this.db.transaction([e],"readonly"),f=null,l=a.objectStore(e),c=null,h=null,p=null,d=null;r.conditions?t.each(l.indexNames,function(e){f||(c=l.index(e),r.conditions[c.keyPath]instanceof Array?(h=r.conditions[c.keyPath][0]>r.conditions[c.keyPath][1]?r.conditions[c.keyPath][1]:r.conditions[c.keyPath][0],p=r.conditions[c.keyPath][0]>r.conditions[c.keyPath][1]?r.conditions[c.keyPath][0]:r.conditions[c.keyPath][1],d=o.bound(h,p,!0,!0),r.conditions[c.keyPath][0]>r.conditions[c.keyPath][1]?f=c.openCursor(d,window.IDBCursor.PREV||"prev"):f=c.openCursor(d,window.IDBCursor.NEXT||"next")):r.conditions[c.keyPath]!=undefined&&(d=o.only(r.conditions[c.keyPath]),f=c.openCursor(d)))}):r.range?(h=r.range[0]>r.range[1]?r.range[1]:r.range[0],p=r.range[0]>r.range[1]?r.range[0]:r.range[1],d=o.bound(h,p),r.range[0]>r.range[1]?f=l.openCursor(d,window.IDBCursor.PREV||"prev"):f=l.openCursor(d,window.IDBCursor.NEXT||"next")):f=l.openCursor(),typeof f=="undefined"||!f?r.error("No Cursor"):(f.onerror=function(e){r.error("readCursor error",e)},f.onsuccess=function(e){var t=e.target.result;if(!t)r.addIndividually||r.clear?n.trigger("reset"):r.success(i);else if(r.limit&&u>=r.limit)d&&r.conditions[c.keyPath]?t.continue(r.conditions[c.keyPath][1]+1):t.continue();else if(r.offset&&r.offset>s)s++,t.continue();else{if(r.addIndividually)n.add(t.value);else if(r.clear){var o=l.delete(t.value.id);o.onsuccess=function(e){i.push(t.value)},o.onerror=function(e){i.push(t.value)}}else i.push(t.value);u++,t.continue()}})},close:function(){this.db&&this.db.close()}},f.prototype={ready:function(){this.started=!0,t.each(this.stack,function(e){this.execute(e)}.bind(this)),this.stack=[],this.next()},execute:function(e){this.started?this.driver.execute(e[2].storeName||e[1].storeName,e[0],e[1],e[2]):this.stack.push(e)},close:function(){this.driver.close()}};var l={};return e.ajaxSync=e.sync,e.sync=c,{sync:c,debugLog:a}}),define("db/ProductsDB",["backbone","backbone-indexeddb"],function(e){return{id:"productsDB",description:"POS products database",migrations:[{version:1,migrate:function(e,t){var n;e.db.objectStoreNames.contains("products")||(n=e.db.createObjectStore("products",{keyPath:"id"})),n.createIndex("titleIndex","title",{unique:!1}),t()}},{version:2,migrate:function(e,t){var n;e.db.objectStoreNames.contains("products")||(n=e.db.createObjectStore("products",{keyPath:"id"})),n=e.objectStore("products"),n.createIndex("barcodeIndex","barcode",{unique:!0}),t()}}]}}),define("models/Product",["backbone","db/ProductsDB"],function(e,t){var n=e.Model.extend({database:t,storeName:"products"});return n}),define("settings",[],function(){var e=function(e){if(!Modernizr.localstorage)return!1;var t=localStorage.getItem(e);return t},t=function(e,t){return Modernizr.localstorage?(localStorage.setItem(e,t),console.log("saved "+e+": "+t),!0):!1};return{get:e,set:t}}),define("collections/Products",["underscore","backbone","backbone-paginator","models/Product","settings","db/ProductsDB"],function(e,t,n,r,i,s){var o=t.PageableCollection.extend({database:s,storeName:"products",model:r,mode:"client",params:pos_params,state:{pageSize:5,totalRecords:null,sortKey:"updated_at",order:1},initialize:function(){this.serverSync()},serverSync:function(){var e=this;$("#pagination").addClass("working"),this.auditProducts().then(function(t){if(t.length>0)return e.removeProducts(t)}).then(function(){e.startWorker()})},clear:function(){var e=this;t.sync("delete",this,{success:function(){e.fullCollection.reset(),i.set("last_update",null)},error:function(){alert("There was a problem clearing the database")}})},startWorker:function(){var e=this,t=new Worker(this.params.worker);t.addEventListener("message",function(t){var n=t.data.status;switch(n){case"success":console.log(t.data.msg),e.fetch();break;case"error":alert(t.data.msg);break;case"complete":console.log(t.data.msg),i.set("last_update",Date.now()),e.trigger("sync"),$("#pagination").removeClass("working");break;case"noIndexedDB":e.saveProducts(t.data.products,t.data.last);break;default:}},!1);var n=this.formatLastUpdateFilter(i.get("last_update"));t.postMessage({cmd:"sync",last_update:n,ajax_url:this.params.ajax_url})},auditProducts:function(){var t=this;return $.getJSON(this.params.ajax_url,{action:"pos_get_product_ids"}).then(function(n){if(n instanceof Array){var r=t.fullCollection.models,i=[];for(var s=0;s<r.length;s++)i.push(r[s].id);var o=e.difference(i,n);return console.log(o.length+" products need to be deleted"),o}console.log("server response is no good")},function(e,t,n){console.log("error "+t),console.log("incoming Text "+e.responseText),alert(n)})},removeProducts:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++){var n=this.fullCollection.get(e[t]),r=n.destroy();this.remove(n)}console.log(t+" products removed")}},saveProducts:function(e,t){function s(){if(!(r<e.products.length)){console.log("Saved "+r+" products"),n.fetch({reset:!0}),t&&(console.log("Sync complete!"),i.set("last_update",Date.now()),$("#pagination").removeClass("working"));return}n.fullCollection.create(e.products[r],{merge:!0,silent:!0,success:s,error:function(e,t){console.log("error saving model: "+t.title)}}),r++}var n=this,r=0;console.log("saving "+e.products.length+" products"),s()},formatLastUpdateFilter:function(e){function n(e){return e<10?"0"+e.toString():e.toString()}var t=new Date(parseInt(e));if(t.getTime()>0){var r=t.getUTCFullYear(),i=n(t.getUTCMonth()+1),s=n(t.getUTCDate()),o=n(t.getUTCHours()),u=n(t.getUTCMinutes()),a=n(t.getUTCSeconds());return r+"-"+i+"-"+s+"T"+o+":"+u+":"+a+"Z"}return null}});return o}),define("views/Product",["underscore","backbone"],function(e,t){var n=t.View.extend({tagName:"tr",template:e.template($("#tmpl-product").html()),events:{"click a.add-to-cart":"add"},initialize:function(e){this.pubSub=e.pubSub,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},add:function(e){typeof e.target!="undefined"&&e.preventDefault(),this.pubSub.trigger("addToCart",this.model)}});return n}),define("views/ProductFilter",["underscore","backbone"],function(e,t){var n=t.View.extend({el:$("#filter"),events:{"keydown input[type=search]":"search",submit:"search","click a.clear":"clear"},wait:149,initialize:function(n){var r,i=this;this.pubSub=n.pubSub,this.searchBox().focus();if(this.collection.mode==="server")this.name="filter[q]",r=this.collection,t.PageableCollection&&r instanceof t.PageableCollection&&(r.queryParams[this.name]=function(){return i.searchBox().val()||null});else{this.fields=["title","barcode"],this._debounceMethods(["search","clear"]),r=this.collection=this.collection.fullCollection||this.collection;var s=this.shadowCollection=r.clone();this.listenTo(r,"add",function(e,t,n){s.add(e,n)}),this.listenTo(r,"remove",function(e,t,n){s.remove(e,n)}),this.listenTo(r,"sort",function(e){this.searchBox().val()||s.reset(e.models)}),this.listenTo(r,"reset",function(t,n){n=e.extend({reindex:!0},n||{}),n.reindex&&n.from==null&&n.to==null&&s.reset(t.models)})}},_debounceMethods:function(t){e.isString(t)&&(t=[t]),this.undelegateEvents();for(var n=0,r=t.length;n<r;n++){var i=t[n],s=this[i];this[i]=e.debounce(s,this.wait)}this.delegateEvents()},makeRegExp:function(e){return new RegExp(e.trim().split(/\s+/).join("|"),"i")},makeMatcher:function(e){var t=this.makeRegExp(e),n=this;return function(r){var i=this.fields||r.keys();for(var s=0,o=i.length;s<o;s++)if(t.test(r.get(i[s])+""))return i[s]==="barcode"&&e===r.get(i[s])&&n.pubSub.trigger("addToCart",r),!0;return!1}},searchBox:function(){return this.$el.find("input[type=search]")},search:function(e){this.collection.mode==="server"?this.serverSearch(e):this.clientSearch(e)},clientSearch:function(t){typeof t!="undefined"&&t.preventDefault(),this.showClearButtonMaybe();var n=e.bind(this.makeMatcher(this.searchBox().val()),this),r=this.collection;r.pageableCollection&&r.pageableCollection.getFirstPage({silent:!0}),r.reset(this.shadowCollection.filter(n),{reindex:!1})},serverSearch:function(e){this.showClearButtonMaybe();if(e.keyCode===13){var n={},r=this.searchBox().val();r&&(n[this.name]=r);var i=this.collection;t.PageableCollection&&i instanceof t.PageableCollection?i.getFirstPage({data:n,reset:!0,fetch:!0}):i.fetch({data:n,reset:!0})}},clearButton:function(){return this.$el.find("a.clear")},clear:function(e){typeof e!="undefined"&&e.preventDefault(),this.clearSearchBox(),this.collection.mode==="server"?t.PageableCollection&&this.collection instanceof t.PageableCollection?this.collection.getFirstPage({reset:!0,fetch:!0}):this.collection.fetch({reset:!0}):(this.collection.pageableCollection&&this.collection.pageableCollection.getFirstPage({silent:!0}),this.collection.reset(this.shadowCollection.models,{reindex:!1}))},clearSearchBox:function(){this.value=null,this.searchBox().val(null),this.showClearButtonMaybe()},showClearButtonMaybe:function(){var e=this.clearButton(),t=this.searchBox().val();t?e.show():e.hide()}});return n}),define("views/ProductPagination",["underscore","backbone","settings"],function(e,t,n){var r=t.View.extend({el:$("#pagination"),template:e.template($("#tmpl-pagination").html()),fallbackTemplate:e.template($("#tmpl-fallback-pagination").html()),initialize:function(){this.collection.on("sync reset",this.render,this),this.render()},events:{"click a.prev":"previous","click a.next":"next","click a.sync":"sync","click a.destroy":"clear"},render:function(){var e;if(Modernizr.indexeddb){e=this.collection.state,e.currentRecords=this.collection.length;var t=new Date(parseInt(n.get("last_update")));e.last_update=t.getTime()>0?t.toLocaleTimeString():"never"}else e=this.collection.state,e.currentPage===e.lastPage?e.currentRecords=e.totalRecords-e.pageSize*(e.currentPage-1):e.currentRecords=e.pageSize;return this.$el.html(this.template(e)),this},previous:function(){return this.collection.hasPreviousPage()&&this.collection.getPreviousPage(),!1},next:function(){return this.collection.hasNextPage()&&this.collection.getNextPage(),!1},sync:function(){return this.collection.serverSync(),!1},clear:function(){return this.collection.clear(),!1}});return r}),define("collections/ProductsFallback",["backbone","backbone-paginator","models/Product"],function(e,t,n){var r=e.PageableCollection.extend({url:"/wc-api/v1/products",model:n,mode:"server",state:{pageSize:5},initialize:function(){},queryParams:{pos:1,filter:{limit:5},totalPages:null},parseState:function(e,t,n,r){var i=parseInt(r.xhr.getResponseHeader("X-WC-Total")),s=parseInt(r.xhr.getResponseHeader("X-WC-TotalPages"));return{totalRecords:i,totalPages:s}},parseRecords:function(e,t){return e.products}});return r}),define("views/ProductList",["backbone","collections/Products","views/Product","views/ProductFilter","views/ProductPagination","collections/ProductsFallback"],function(e,t,n,r,i,s){var o=e.View.extend({el:$("#product-list"),elEmpty:$("#product-list").contents().clone(),initialize:function(e){this.pubSub=e.pubSub,Modernizr.indexeddb?this.collection=new t:this.collection=new s,new r({pubSub:this.pubSub,collection:this.collection}),new i({pubSub:this.pubSub,collection:this.collection}),this.listenTo(this.collection,"reset sync",this.render),this.collection.fetch()},render:function(){this.collection.length===0?this.emptyMessage():this.$el.removeClass("empty").html(""),this.collection.each(function(e){var t=new n({pubSub:this.pubSub,model:e});this.$el.append(t.render().el)},this)},emptyMessage:function(){this.$el.addClass("empty").html(this.elEmpty)}});return o}),function(e,t){function n(e){return!!(""===e||e&&e.charCodeAt&&e.substr)}function r(e){return c?c(e):"[object Array]"===h.call(e)}function i(e){return"[object Object]"===h.call(e)}function s(e,t){var n,e=e||{},t=t||{};for(n in t)t.hasOwnProperty(n)&&null==e[n]&&(e[n]=t[n]);return e}function o(e,t,n){var r=[],i,s;if(!e)return r;if(l&&e.map===l)return e.map(t,n);for(i=0,s=e.length;i<s;i++)r[i]=t.call(n,e[i],i,e);return r}function u(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function a(e){var t=f.settings.currency.format;return"function"==typeof e&&(e=e()),n(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:!e||!e.pos||!e.pos.match("%v")?n(t)?f.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t:e}var f={version:"0.3.2",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},l=Array.prototype.map,c=Array.isArray,h=Object.prototype.toString,p=f.unformat=f.parse=function(e,t){if(r(e))return o(e,function(e){return p(e,t)});e=e||0;if("number"==typeof e)return e;var t=t||".",n=RegExp("[^0-9-"+t+"]",["g"]),n=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(n,"").replace(t,"."));return isNaN(n)?0:n},d=f.toFixed=function(e,t){var t=u(t,f.settings.number.precision),n=Math.pow(10,t);return(Math.round(f.unformat(e)*n)/n).toFixed(t)},v=f.formatNumber=function(e,t,n,a){if(r(e))return o(e,function(e){return v(e,t,n,a)});var e=p(e),l=s(i(t)?t:{precision:t,thousand:n,decimal:a},f.settings.number),c=u(l.precision),h=0>e?"-":"",m=parseInt(d(Math.abs(e||0),c),10)+"",g=3<m.length?m.length%3:0;return h+(g?m.substr(0,g)+l.thousand:"")+m.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+l.thousand)+(c?l.decimal+d(Math.abs(e),c).split(".")[1]:"")},m=f.formatMoney=function(e,t,n,l,c,h){if(r(e))return o(e,function(e){return m(e,t,n,l,c,h)});var e=p(e),d=s(i(t)?t:{symbol:t,precision:n,thousand:l,decimal:c,format:h},f.settings.currency),g=a(d.format);return(0<e?g.pos:0>e?g.neg:g.zero).replace("%s",d.symbol).replace("%v",v(Math.abs(e),u(d.precision),d.thousand,d.decimal))};f.formatColumn=function(e,t,l,c,h,d){if(!e)return[];var m=s(i(t)?t:{symbol:t,precision:l,thousand:c,decimal:h,format:d},f.settings.currency),g=a(m.format),y=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,b=0,e=o(e,function(e){return r(e)?f.formatColumn(e,m):(e=p(e),e=(0<e?g.pos:0>e?g.neg:g.zero).replace("%s",m.symbol).replace("%v",v(Math.abs(e),u(m.precision),m.thousand,m.decimal)),e.length>b&&(b=e.length),e)});return o(e,function(e){return n(e)&&e.length<b?y?e.replace(m.symbol,m.symbol+Array(b-e.length+1).join(" ")):Array(b-e.length+1).join(" ")+e:e})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.accounting=f):"function"==typeof define&&define.amd?define("accounting",[],function(){return f}):(f.noConflict=function(n){return function(){return e.accounting=n,f.noConflict=t,f}}(e.accounting),e.accounting=f)}(this),function(e,t){typeof exports=="object"&&typeof require=="function"?module.exports=t(require("underscore"),require("backbone")):typeof define=="function"&&define.amd?define("backbone-localstorage",["underscore","backbone"],function(n,r){return t(n||e._,r||e.Backbone)}):t(_,Backbone)}(this,function(e,t){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}function r(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}return t.LocalStorage=window.Store=function(e){if(!this.localStorage)throw"Backbone.localStorage: Environment does not support localStorage.";this.name=e;var t=this.localStorage().getItem(this.name);this.records=t&&t.split(",")||[]},e.extend(t.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||(e.id=r(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.records.push(e.id.toString()),this.save(),this.find(e)},update:function(t){return this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),e.include(this.records,t.id.toString())||this.records.push(t.id.toString()),this.save(),this.find(t)},find:function(e){return this.jsonData(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){return(e.chain||e)(this.records).map(function(e){return this.jsonData(this.localStorage().getItem(this.name+"-"+e))},this).compact().value()},destroy:function(t){return t.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+t.id),this.records=e.reject(this.records,function(e){return e===t.id.toString()}),this.save(),t)},localStorage:function(){return localStorage},jsonData:function(e){return e&&JSON.parse(e)},_clear:function(){var t=this.localStorage(),n=new RegExp("^"+this.name+"-");t.removeItem(this.name),(e.chain||e)(t).keys().filter(function(e){return n.test(e)}).each(function(e){t.removeItem(e)}),this.records.length=0},_storageSize:function(){return this.localStorage().length}}),t.LocalStorage.sync=window.Store.sync=t.localSync=function(e,n,r){var i=n.localStorage||n.collection.localStorage,s,o,u=t.$.Deferred&&t.$.Deferred();try{switch(e){case"read":s=n.id!=undefined?i.find(n):i.findAll();break;case"create":s=i.create(n);break;case"update":s=i.update(n);break;case"delete":s=i.destroy(n)}}catch(a){a.code===22&&i._storageSize()===0?o="Private browsing is unsupported":o=a.message}return s?(r&&r.success&&(t.VERSION==="0.9.10"?r.success(n,s,r):r.success(s)),u&&u.resolve(s)):(o=o?o:"Record Not Found",r&&r.error&&(t.VERSION==="0.9.10"?r.error(n,o,r):r.error(o)),u&&u.reject(o)),r&&r.complete&&r.complete(s),u&&u.promise()},t.ajaxSync=t.sync,t.getSyncMethod=function(e){return e.localStorage||e.collection&&e.collection.localStorage?t.localSync:t.ajaxSync},t.sync=function(e,n,r){return t.getSyncMethod(n).apply(this,[e,n,r])},t.LocalStorage}),define("models/CartItem",["backbone","accounting","backbone-localstorage"],function(e,t,n){var r=e.Model.extend({defaults:{display_price:0,display_total:0,item_discount:0,item_price:0,line_total:0,qty:1,line_tax:0,item_tax:0,total_discount:0},params:pos_params,initialize:function(){t.settings=this.params.accounting,this.listenTo(this,"change:qty change:display_price",this.updateLineTotals),this.get("display_price")===0&&this.set({display_price:t.formatNumber(this.get("price"))})},updateLineTotals:function(){var e=this.get("qty"),n=parseFloat(t.unformat(this.get("display_price"),t.settings.number.decimal)),r=parseFloat(this.get("price")),i=0,s=0,o=0,u=0,a=this.get("taxable");a&&this.params.wc.calc_taxes==="yes"&&this.calcTax(n,e,this.get("tax_rates")),s=r-n,o=this.params.wc.prices_include_tax==="yes"?n-this.get("item_tax"):n,u=this.displayTotal(r,a),this.save({item_price:this.roundNum(o),item_discount:this.roundNum(s),total_discount:this.roundNum(s*e),line_total:this.roundNum(o*e),display_total:t.formatNumber(u*e)})},calcTax:function(e,t,n){var r=0;return this.params.wc.prices_include_tax==="yes"?r=this.calcInclusiveTax(e,t,n):r=this.calcExclusiveTax(e,t,n),r},calcInclusiveTax:function(e,t,n){var r=0,i=0,s=0,o=0,u=0,a=0;_(n).each(function(e){e.compound===1?i+=parseFloat(e.rate):r+=parseFloat(e.rate)});var f=1+r/100,l=1+i/100;s=e/l,_(n).each(function(n,r){var i=parseFloat(n.rate)/100,c=0;n.compound===1?(c=e,i/=l):(c=s,i/=f);var h=e-i*c;o=e-h;var p=this.roundNum(o),d=this.roundNum(o*t);this.set("item_tax_"+r,p),this.set("line_tax_"+r,d),u+=p,a+=d},this),this.set("item_tax",this.roundNum(u)),this.set("line_tax",this.roundNum(a))},calcExclusiveTax:function(e,t,n){var r=[],i=0,s=0,o=0,u=0;_(n).each(function(t,n){t.compound!=="yes"&&(s=e*(parseFloat(t.rate)/100)),i+=s,r[n]=s}),_(n).each(function(n,r){if(n.compound==="yes"){var a=e+i;s=a*(parseFloat(n.rate)/100)}var f=this.roundNum(s),l=this.roundNum(s*t);this.set("item_tax_"+r,f),this.set("line_tax_"+r,l),o+=f,u+=l},this),this.set("item_tax",this.roundNum(o)),this.set("line_tax",this.roundNum(u))},displayTotal:function(e,t){var n=0;return t&&this.params.wc.calc_taxes==="yes"&&(n=this.get("line_tax"),this.params.wc.prices_include_tax==="no"&&this.params.wc.tax_display_cart==="incl"?e+=n:this.params.wc.prices_include_tax==="yes"&&this.params.wc.tax_display_cart==="excl"&&(e-=n)),e},roundNum:function(e){return this.params.wc.tax_round_at_subtotal==="no"?parseFloat(e.toFixed(4)):e},quantity:function(e){var t=this.get("qty");this.set("qty",e==="increase"?++t:--t)}});return r}),define("models/CartTotals",["backbone","backbone-localstorage"],function(e,t){var n=e.Model.extend({localStorage:new e.LocalStorage("cart_totals"),defaults:{title:"Cart Totals",note:"",order_discount:0},initialize:function(){}});return n}),+function(e){var t=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},t.prototype.show=function(t){var n=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r);if(this.isShown||r.isDefaultPrevented())return;this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),r&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var i=e.Event("shown.bs.modal",{relatedTarget:t});r?n.$element.find(".modal-dialog").one(e.support.transition.end,function(){n.$element.trigger("focus").trigger(i)}).emulateTransitionEnd(300):n.$element.trigger("focus").trigger(i)})},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]!==e.target&&!this.$element.has(e.target).length&&this.$element.trigger("focus")},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){e.which==27&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){n.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,s).emulateTransitionEnd(150):s()}else t&&t()},t.prototype.checkScrollbar=function(){if(document.body.clientWidth>=window.innerWidth)return;this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar()},t.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0);this.scrollbarWidth&&this.$body.css("padding-right",e+this.scrollbarWidth)},t.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},t.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var n=e.fn.modal;e.fn.modal=function(n,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},t.DEFAULTS,i.data(),typeof n=="object"&&n);s||i.data("bs.modal",s=new t(this,o)),typeof n=="string"?s[n](r):o.show&&s.show(r)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());n.is("a")&&t.preventDefault(),i.modal(s,this).one("hide",function(){n.is(":visible")&&n.trigger("focus")})})}(jQuery),define("bootstrap-modal",function(){}),define("views/Checkout",["underscore","backbone","accounting","bootstrap-modal"],function(e,t,n){var r=t.View.extend({className:"modal fade",template:e.template($("#tmpl-order").html()),totalsTemplate:e.template($("#tmpl-order-total").html()),params:pos_params,events:{"hidden.bs.modal":"teardown","click #close":"close","click #print":"print"},initialize:function(t){n.settings=this.params.accounting,e(this).bindAll(),this.cart=t.cart,this.totals=t.totals},process:function(e){var t=this;$.post(pos_params.ajax_url,{action:"pos_process_order",cart:e}).done(function(e){t.order=e.order,t.render()}).fail(function(e,t,n){console.log(e)})},teardown:function(){this.$el.removeData("modal"),this.remove()},close:function(){e.invoke(this.cart.toArray(),"destroy"),this.$el.modal("hide")},print:function(){this.$el.addClass("print-modal"),$("#page").hide(),window.print(),$("#page").show(),this.$el.removeClass("print-modal")},render:function(){var t=this.cart.toJSON(),r=this.order.id;e(t).each(function(e){e.display_price=n.formatMoney(e.display_price)}),console.log(t),this.$el.html(this.template({order_id:r,cart:t}));var i=this.totals.toJSON(),s=n.unformat(this.totals.get("total_check"),n.settings.number.decimal);return console.log("wc: "+this.order.total+", pos: "+s),parseFloat(this.order.total)!==parseFloat(s)&&(i.total_mismatch=!0),this.$el.find("tfoot").html(this.totalsTemplate(i)),this.$el.modal({show:!0,backdrop:"static"}),$("#cart .actions").removeClass("working"),this}});return r}),define("views/CartTotals",["underscore","backbone","views/Checkout","accounting"],function(e,t,n,r){var i=t.View.extend({el:$("#cart-totals"),template:e.template($("#tmpl-cart-total").html()),events:{"click .actions":"cartActions","click .note":"edit","click .order-discount":"edit","keypress .note":"saveOnEnter","keypress .order-discount":"saveOnEnter","blur .note":"save","blur .order-discount":"save"},params:pos_params,initialize:function(e){r.settings=this.params.accounting,this.cart=e.cart,this.listenTo(this.model,"change sync",this.render)},render:function(){this.$el.removeClass("empty").html("");var e=this.model.toJSON();return e.subtotal=r.formatMoney(e.subtotal),e.cart_discount=r.formatMoney(e.cart_discount*-1),e.tax=r.formatMoney(e.tax),e.total=r.formatMoney(e.total),e.order_discount=r.formatMoney(e.order_discount*-1),this.$el.html(this.template(e)),this},cartActions:function(t){var r=t.target.className.match(/\saction-([a-z]+)/);if(!r)return;switch(r[1]){case"void":e.invoke(this.cart.toArray(),"destroy");break;case"note":var i=this.$(".note").toggle().is(":visible");i?this.$(".note").children("td").attr("contenteditable","true").focus():this.$(".note").children("td").blur();break;case"discount":var i=this.$(".order-discount").toggle().is(":visible");i?this.$(".order-discount").children("td").attr("contenteditable","true").focus():this.$(".order-discount").children("td").blur();break;case"checkout":$(t.target).attr("disabled","disabled"),$("#cart .actions").addClass("working");var s=this.cart.map(function(t){return e.pick(t.toJSON(),["id","qty","line_total"])}),o=new n({cart:this.cart,totals:this.model});o.process(s)}},edit:function(e){$(e.currentTarget).children("td").attr("contenteditable","true").focus()},saveOnEnter:function(e){e.which===13&&(e.preventDefault(),$(e.currentTarget).children("td").blur())},save:function(e){var t=e.currentTarget.className;if(!t)return;var n=$(e.target).text();switch(t){case"note":this.model.save({note:n});break;case"order-discount":n=parseFloat(n);if(isNaN(n)){$(e.target).focus();return}n===""?$(e.currentTarget).hide():this.model.save({order_discount:n})}}});return i}),define("collections/CartItems",["underscore","backbone","models/CartItem","models/CartTotals","views/CartTotals","backbone-localstorage"],function(e,t,n,r,i,s){var o=t.Collection.extend({model:n,params:pos_params,initialize:function(e,n){this.localStorage=new t.LocalStorage("cart-"+n.cartId),this.cartTotals=new r({id:n.cartId}),this.cartTotalsView=new i({model:this.cartTotals,cart:this}),this.cartTotals.fetch(),this.listenTo(this,"add change remove reset",this.updateTotals),this.listenTo(this.cartTotals,"change:order_discount",this.updateTotals)},updateTotals:function(){var t=0,n=0,r=0,i=0,s=0,o=0,u={},a={};if(this.length===0){this.cartTotals.set({note:"",order_discount:0},{silent:!0}),this.cartTotalsView.$el.html("").addClass("empty");return}t=e(this.pluck("line_total")).reduce(function(e,t){return e+t},0),r=e(this.pluck("total_discount")).reduce(function(e,t){return e+t},0),this.params.wc.calc_taxes==="yes"&&(s=e(this.pluck("line_tax")).reduce(function(e,t){return e+t},0)),i=this.cartTotals.get("order_discount"),n=t+r,o=t+s-i,this.params.wc.tax_display_cart==="incl"&&(n+=s),s!==0&&this.params.wc.tax_total_display==="itemized"&&(a=this.tax_rates(),e.each(a,function(t,n){var r=0;r=e.reduce(e.compact(this.pluck("line_tax_"+n)),function(e,t){return e+t},0),r!==0&&(u[t.label]=r)},this));var f=r!==0?!0:!1,l=s!==0?!0:!1,c=!e.isEmpty(u),h={subtotal:n,cart_discount:r,tax:s,total:o,show_discount:f,show_tax:l,show_itemized:c,itemized_tax:u};this.cartTotals.save(h)},tax_rates:function(){var t=[],n={};return t=e.compact(this.pluck("tax_rates")),t.length>0&&(n=e.reduce(t,function(t,n){return e.merge(t,n)},{})),n}});return o}),define("autoGrowInput",["jquery"],function(e){e.fn.extend({autoGrowInput:function(){return this.each(function(){var t=e(this),n=e("<div />").css({opacity:0,top:-9999,left:-9999,position:"absolute",whiteSpace:"nowrap"}).addClass("POS-input-width-tester"),r="keydown keyup input propertychange change";t.next(".POS-input-width-tester").remove(),t.after(n),t.unbind(r).bind(r,function(e,r){r&&(e=r);var i=t.val();i=i.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n.html(i);var s=n.width();t.width(s+20)}),t.trigger("change")})}})}),define("views/CartItem",["underscore","backbone","accounting","autoGrowInput"],function(e,t,n,r){var i=t.View.extend({tagName:"tr",template:e.template($("#tmpl-cart-item").html()),params:pos_params,events:{"click .remove a":"removeFromCart","click input":"change","keypress input":"updateOnEnter","blur input":"close"},initialize:function(e){n.settings=this.params.accounting,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON(),t=n.unformat(e.display_total,n.settings.number.decimal);return e.total_discount!==0&&(e.discounted=n.formatMoney(t-e.total_discount)),e.display_total=n.formatMoney(t),this.$el.html(this.template(e)),this.$("input").autoGrowInput(),this},removeFromCart:function(e){typeof e.target!="undefined"&&e.preventDefault(),this.$el.fadeOut(200,function(){$(this).remove()}),this.model.destroy()},change:function(e){this.$(e.target).addClass("editing").focus().select()},close:function(e){var t=$(e.target),r=t.data("id"),i=t.val(),s=n.unformat(i,n.settings.number.decimal);switch(r){case"qty":if(i===this.model.get("qty"))break;if(i===0){this.removeFromCart();break}i?(this.model.save({qty:i}),t.removeClass("editing")):t.focus();break;case"price":isNaN(s)?t.focus():(i=n.formatNumber(s),this.model.save({display_price:i}))}},updateOnEnter:function(e){e.keyCode===13&&this.close(e)}});return i}),define("views/CartList",["backbone","collections/CartItems","views/CartItem"],function(e,t,n){var r=e.View.extend({el:$("#cart-items"),elEmpty:$("#cart-items").contents().clone(),initialize:function(e){this.collection=new t([],{cartId:1}),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"reset remove",this.render),this.collection.fetch({reset:!0}),this.listenTo(e.pubSub,"addToCart",this.addToCart,this)},render:function(){this.collection.length===0&&this.emptyMessage()},addToCart:function(e){_(this.collection.pluck("id")).contains(e.attributes.id)?this.collection.get(e.attributes.id).quantity("increase"):this.collection.create(e.attributes)},addOne:function(e){this.collection.length===1&&this.$el.removeClass("empty").html("");var t=new n({model:e,cart:this.collection});this.$el.append(t.render().el),this.$("input").trigger("change")},addAll:function(){this.$el.removeClass("empty").html(""),this.collection.each(this.addOne,this)},emptyMessage:function(){this.$el.addClass("empty").html(this.elEmpty)}});return r}),define("jquery",[],function(){return jQuery}),require.config({baseUrl:"/wp-content/plugins/woocommerce-pos/public/assets/js",paths:{underscore:"../../../bower_components/lodash/dist/lodash.min",backbone:"../../../bower_components/backbone/backbone",accounting:"../../../bower_components/accounting/accounting.min",settings:"../../../public/assets/js/src/Settings","bootstrap-modal":"../../../bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/modal","bootstrap-dropdown":"../../../bower_components/bootstrap-sass-official/vendor/assets/javascripts/bootstrap/dropdown","backbone-indexeddb":"../../../bower_components/indexeddb-backbonejs-adapter/backbone-indexeddb","backbone-localstorage":"../../../bower_components/backbone.localStorage/backbone.localStorage","backbone-paginator":"../../../bower_components/backbone.paginator/lib/backbone.paginator.min",pushy:"../../../public/assets/js/src/pushy",autoGrowInput:"../../../public/assets/js/src/jquery.autoGrowInput"},shim:{}}),require(["underscore","backbone","views/ProductList","views/CartList"],function(e,t,n,r){var i=e.extend({},t.Events);new n({pubSub:i}),new r({pubSub:i})}),define("main",function(){});